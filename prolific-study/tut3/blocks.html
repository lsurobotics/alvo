<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Mobile robot programming.</title>
  <link rel="stylesheet" href="../lib/bootstrap/bootstrap.min.css">
  <link rel="stylesheet" href="../css/style.css">
  <script src="../lib/bootstrap/jquery.min.js"></script>
  <script src="../lib/bootstrap/bootstrap.bundle.min.js"></script>
  <script src="../lib/anime/anime.min.js"></script>
</head>
<body>
  <!-- HTML Elements -->
  <div class="taskcontainer">
    <h4>Tutorial 3: Using Triggers and Machines</h4>
      <div id="steps" style="grid-column-end: span 4">
        <p>Task:</p>
        <ol>
          <li>Move the green box <img src="../media/item-green.png" style="height:20px; width:20px"> from Station A to the item processor machine at Station B.</li>
          <li>Turn on the machine <img src="../media/machine.png" style="height:38px; width:38px; margin-top:3px;"> to process the green box into a round shape <img src="../media/item-green.png" style="height:18px; width:18px; border-radius: 50%;">.</li>
          <li>After processing is complete, move the green box into the chute <img src="../media/bin.png" style="height:25px; width:25px"> at Station C.</li>
        </ol>
        <p>This task requires you to use what you have learned before, but it will also introduce some new elements. You can click on each step to get more detailed instructions.</p>
        <ol class="accordion-group">
          <li><a href="#step1" data-toggle="collapse">Turn on the machine</a>
            <ol id="step1" class="collapse" data-parent="#steps" style="list-style-type: lower-alpha">
              <li>As you can see below, we have already added some blocks to solve the first part of the task: The robot will pick up the box from Station A and transport it to Station B where it gets placed into the machine. Note that boxes need to get placed in the <strong>middle center</strong> position to fit into the machine.</li>
              <li>What is missing is to turn on the machine. To do so, you have to modify the second of the two existing tasks. Select that task (the one that takes place at Station B) and add a <img src="machineblock.png" style="height:30px"> block at the end of the task.</li>
              <li>We recommend that you try out the program up to this point. As you will see, the machine takes some time to process the box. It is only finished once it has returned to its regular colour, and the robot has to wait until then before it can pick up the box.</li>
            </ol>
          </li>
          <li><a href="#step2" data-toggle="collapse">Add a trigger that reacts to when the machine is finished</a>
            <ol id="step2" class="collapse" data-parent="#steps" style="list-style-type: lower-alpha">
              <li>Since the machine takes a while to process the box, you cannot simply continue by moving the box to Station C. Instead, you will have to tell the robot when it is ready to continue.</li>
              <li>Open the <img src="triggersmenu.png" style="height:22px; border: solid 1px #333"> menu below and drag the <img src="newtrigger.png" style="height:30px"> block from there onto the canvas. It does not attach to the existing blocks, but can go anywhere.</li>
              <li>Click on <img src="newtriggername.png" style="height:22px"> and change the trigger's name so that it describes what you want the robot to react to. For this trigger, you can for example pick the name "Machine is finished".</li>
            </ol>
          </li>
          <li><a href="#step3" data-toggle="collapse">Program the trigger</a>
            <ol id="step3" class="collapse" data-parent="#steps" style="list-style-type: lower-alpha">
              <li>The trigger has to be programmed, similar to the robot itself. Click on the trigger you just placed to open the trigger editor on the right.</li>
              <li>Triggers use different blocks than tasks. You can find signals to react to in the <img src="signalsmenu.png" style="height:22px; border: solid 1px #333"> menu and blocks to connect them in the <img src="combinatorsmenu.png" style="height:22px; border: solid 1px #333"> menu.</li>
              <li>For the trigger to react to the machine being finished, you have to use a <img src="machinerunning.png" style="height:30px"> block and a <img src="machineempty.png" style="height:30px"> block. </li>
              <li>You can attach the blocks to the trigger in any order. Make sure to select <img src="stationB.png" style="height:18px"> for both blocks, and to select <img src="idle.png" style="height:18px"> and <img src="nonempty.png" style="height:18px">.</li>
            </ol>
          </li>
          <li><a href="#step4" data-toggle="collapse">Finish and test the program</a>
            <ol id="step4" class="collapse" data-parent="#steps" style="list-style-type: lower-alpha">
              <li>Now that you have programmed the trigger, you can go back to finishing the program for the robot. Add a new task for picking up the processed box from Station B. This block needs to be attached to the <img src="machinetrigger.png" style="height:30px"> block instead of the other task blocks.</li>
              <li>Finally, you need one more task that places the processed block at Station C. This task block attaches to the block you just created. Since this station has a chute, you have to place an item in the <strong>bottom center</strong> position. The item will disappear once it has been placed.</li>
              <li>You have successfully programmed the entire task. Test your solution by clicking the button below. Watch how the robot executes each step of the program.</li>
            </ol>
          </li>
        </ol>
      <button id="test-button" value="start-test" type="button" class="btn btn-success">Test Current Program</button>
      <button id="test-stop-button" value="stop-test" type="button" class="btn btn-danger">Abort Test</button>
      <span id="task-wait">Task not yet completed! If it is still running and just waiting for a trigger, we will automatically detect when it completes.<br>If you are having issues, please double-check that you have followed the instructions. Have you selected the right station everywhere and used the correct positions for pick-up and placement instructions?</span>
      <span id="task-success">Task completed!<br><br>
      <strong><a style="font-size: 20pt;" href="../task1/blocks.html">Click here to continue with the first task.</a></strong><br>
    </span>
    </div>
  </div>
  <div class="maincontainer twocanvas">
    <div id="leftdiv" class="workspace"></div>
    <div id="middlediv" class="workspace">
      <div id="animatediv" style="margin-left: 0px">
        <div id="stackedRest">
          <div id="stackedDummyDrawer"></div>
        </div>
        <div id="__Pick up boxdiv" class="workspace" style="position: relative;"></div>
        <div id="__Place box in machinediv" class="workspace" style="position: relative;"></div>
      </div>
    </div>
    <div id="rightdiv">
      <div id="simulatorarea">
      <div id="simulatordiv"></div>
      <button id="trigger-button1" value="trigger-button1" type="button" class="btn btn-info">Button 1</button>
      <button id="trigger-button2" value="trigger-button2" type="button" class="btn btn-danger">Button 2</button>
      </div>
      <button id="execution-button" value="start-execution" type="button" class="btn btn-success">Run Program</button>
      <button id="reset-button" value="reset-simulator" type="button" class="btn btn-secondary">Reset Simulator</button>
    </div>
    <div id="output">
    </div>
    <div id="simbuttons">
    </div>
  </div>

  <!-- Starting configuration -->
  <xml xmlns="https://developers.google.com/blockly/xml" id="workspaceBlocks" style="display: none">
       <variables>
      <variable id="Pick up box">Pick up box</variable>
    <variable id="Place box in machine">Place box in machine</variable></variables>
      <block type="custom_start" id="START" x="28" y="28"><next><block type="custom_task" movable="false" deletable="false" editable="false"><field name="TASK">Pick up box</field><field name="SITE">STATIONA</field><next><block type="custom_task" movable="false" deletable="false" editable="false"><field name="TASK">Place box in machine</field><field name="SITE">STATIONB</field></block></next></block></next></block>
  </xml>

  <xml xmlns="https://developers.google.com/blockly/xml" id="pickWorkspaceBlocks" style="display: none">
    <variables>
      <variable id="bottom center">bottom center</variable>
    </variables>
    <block type="custom_taskheader" deletable="false" x="28" y="28"><field name="TASK">Pick up box</field><field name="SITE">STATIONA</field><next><block type="custom_pickup"><value name="LOCATION"><shadow type="custom_dummylocation"></shadow><block type="custom_location"><field name="LOCATION">bottom center</field></block></value></block></next></block></next></block>
  </xml>

  <xml xmlns="https://developers.google.com/blockly/xml" id="placeWorkspaceBlocks" style="display: none">
    <variables>
      <variable id="middle center">middle center</variable>
    </variables>
    <block type="custom_taskheader" deletable="false" x="28" y="28"><field name="TASK">Place box in machine</field><field name="SITE">STATIONB</field><next><block type="custom_place"><value name="LOCATION"><shadow type="custom_dummylocation"></shadow><block type="custom_location"><field name="LOCATION">middle center</field></block></value></block></next></block></next></block>
  </xml>

  <xml xmlns="https://developers.google.com/blockly/xml" id="toolboxLeft" style="display: none">
    <category name="Triggers" colour="#A56D5B" custom="TRIGGERS">
    </category>
    <category name="Tasks" colour="#5C9FA6" custom="TASKS">
    </category>
  </xml>

  <xml xmlns="https://developers.google.com/blockly/xml" id="toolboxRight" style="display: none">
    <category name="Arm" colour="#968e4f">
      <block type="custom_pickup">
        <value name="LOCATION">
          <shadow type="custom_dummylocation">
          </shadow>
        </value>
      </block>
      <block type="custom_place">
        <value name="LOCATION">
          <shadow type="custom_dummylocation">
          </shadow>
        </value>
      </block>
      <block type="custom_turn">
      </block>
    </category>
    <category name="Locations" colour="#A08260" custom="LOCATIONS">
    </category>
    <category name="Machine" colour="#8C5BA5">
      <block type="custom_machine"></block>
    </category>
  </xml>

  <xml xmlns="https://developers.google.com/blockly/xml" id="toolboxTrigger" style="display: none">
    <category name="Signals" colour="#3EA567">
      <block type="custom_button1">
      </block>
      <block type="custom_button2">
      </block>
      <block type="custom_emptygripper">
      </block>
      <block type="custom_machineidle">
      </block>
      <block type="custom_machineempty">
      </block>
    </category>
    <category name="Combinators" colour="#3A54A5">
      <block type="custom_and">
      </block>
      <block type="custom_or">
      </block>
    </category>
  </xml>

  <!-- Javascript Code -->
  <script src="task.js"></script>
  <script src="../lib/mxgraph/mxClient.min.js"></script>
  <script src="../blockly/blockly_uncompressed.js"></script>
  <script src="../blockly/blocks_compressed.js"></script>
  <script src="../blockly/javascript_compressed.js"></script>
  <script src="../js/generator.js"></script>
  <script src="../blockly/msg/js/en.js"></script>
  <script src="../js/blocks.js"></script>
  <script src="../js/simulator.js"></script>
  <script src="../js/graph.js"></script>
  <script src="../js/index.js"></script>
  <script src="../js/twocanvas.js"></script>
  <script src="../js/defposition.js"></script>
</body>
</html>